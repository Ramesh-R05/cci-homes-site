# This resources are only used for HOMESTOLOVE

####################################################################
# Refer to http://docs.shippable.com/reference/resources-overview/ #
####################################################################

resources:
  # Docker Image Options to run the container
  - name: homes-site-opts-sit
    type: dockerOptions
    version:
      memory: 512
      memoryReservation: 256
      cpuShares: 192
      portMappings:
        - 0:3001
      publishAllPorts: true
      logConfig:
        type: awslogs
        options:
          awslogs-group: 'app_ecs'
          awslogs-region: 'ap-southeast-2'
          awslogs-stream-prefix: 'app-homes-site'

  # AWS S3 bucket for storing test result files
  - name: test-result-s3-param-homes
    type: params
    versionTemplate:
      params:
        AWS_S3_BUCKET: 's3://test-result-s3/'
        secure: eLFlf9nWSWJbMdNziICYW5J6aHjIKLsuK5qU/IXyCLXlWyMuaw3HZrPqoL5nqyJYudHYI1se56UVw2AFytKPI11kloH4J7vx/CHz3Lp2AcdBAq/w4ZTWiWVKmq15MUjlUAegOwX2TEBgD4IDnIbdeDgC15kPavRTqtqKEYAi9DgPTgqW02tvsu2Q+xiJFtihqSOD126M2xz1JGEM2dMwZYJSZiMA2CHSSlXhVNZBtonC3PTYwfwKt1o26IrIcVXfy17J/5/6Dme9l8fJLP4bxxCUa8PEpNUqeAt5mDpMPged6sFz+g6mX4kWMLjM6wimpy+tLdHXM+4OhzKfcbT5UA==

  # MASTER Docker Image for the homes-site
  - name: homes-site-img-master
    type: image
    pointer:
      sourceName: '317367993082.dkr.ecr.ap-southeast-2.amazonaws.com/homes-site'
    seed:
      versionName: latest

  # Feature BRANCH Docker Image for the homes-site
  - name: homes-site-img-branch
    type: image
    pointer:
      sourceName: '317367993082.dkr.ecr.ap-southeast-2.amazonaws.com/homes-site'
    seed:
      versionName: latest

  # Homes Github repo
  - name: homes-site-repo
    type: gitRepo
    integration: production-github
    pointer:
      sourceName: bauerxcelmedia/homes-site
      branch: master

  # Homes Github repo branch for lighthouse test only
  - name: homes-site-repo-branch
    type: gitRepo
    integration: production-github
    pointer:
      sourceName: bauerxcelmedia/homes-site
      branch: feature/add-lighthouse-test

  # Slack connection
  - name: homes-slack-notifications
    type: notification #required
    integration: slack-bauerxcelmedia
    pointer:
      recipients:
        - '#au-shippable'

  # Slack connection
  - name: homes-qa-team-notifications
    type: notification #required
    integration: slack-bauerxcelmedia
    pointer:
      recipients:
        - '#bxm_qa_notifications'

    # Slack connection
  - name: homes-deployment-notifications
    type: notification #required
    integration: slack-bauerxcelmedia
    pointer:
      recipients:
        - '#au-shippable'

  # Seed Release version
  # for Rollback refer to below URL
  # http://docs.shippable.com/deploy/rollback/#rolling-back-your-deployments
  - name: homes-site-version
    type: version
    seed:
      versionName: '1.0.0' # This can be changed for Roll back

  #Schedule Run of automation
  # This is using Shippable timezone
  # CRON is (15 22 * * *") this is 10:15pm every day refer to https://en.wikipedia.org/wiki/Cron
  # will run at 9:15am daylight saving or 8:15am standard time in Sydney
  - name: homes-morning-trigger
    type: time
    seed:
      interval: '15 22 * * *'

  #"0 22 * * 2" is 10:00pm Tuesday which is Wednesday morning 9:00am daylight saving or 8:00am standard time in Sydney
  - name: homes-weekly-trigger
    type: time
    seed:
      interval: '0 22 * * 2'

  ####################################
  # NON PROD environment configuration
  ####################################

  # AWS Non Prod Cluster
  - name: homes-env-sit-ecs
    type: cluster
    integration: digital-nonprod-AWS
    pointer:
      sourceName: 'app_ecs'
      region: 'ap-southeast-2'

  # AWS SIT load Balancer - Homes AU - MASTER branch
  - name: homes-site-alb-sit
    type: loadBalancer
    pointer:
      sourceName: 'arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/homes-site-au-sit/5f74d13d06b36b76'
      method: application

  # AWS SIT:8080 load Balancer - Homes AU - feature BRANCH
  - name: homes-site-alb-sit-branch
    type: loadBalancer
    pointer:
      sourceName: 'arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/homes-site-au-branch-sit/3bb9306c82d75ab5'
      method: application

  # AWS TEST load Balancer - Homes STUBBED - MASTER branch
  - name: homes-site-alb-test
    type: loadBalancer
    pointer:
      sourceName: 'arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/homes-site-test/24afa8bb9878bdb9'
      method: application

  # SIT Parameter
  - name: homes-site-params-sit
    type: params
    version:
      params:
        NODE_ENV: 'production' # this is to start APP with production version of react
        APP_ENV: 'sit' # this is to start APP using sit config
        APM_KEY: 'c777240932e6282ffacc6a42ae6a0709426522bb'
        APP_DEBUG:
          true
          # EMAIL_HASH_SERVICE_SECRET_KEY AWS_ACCESS_KEY_ID AWS_SECRET_ACCESS_KEY APP_SERVICES_ACCESS_KEY
        secure: fDacU9ZNJj0YHEhcHPfit3AK8NvIneSRDpw4DBvgb/1hkaj/4mCI1BGBv1RjdRxcxVqZ6k7kf7krhUCJzd+bhIaOn3A0QzKzCxNqQRtU/UAgLvjc6R7RoCXOXesmM5KVxRbghW73oVlTSQ0IUyKQ8NMxK32NeY2n0C/gCC2KHlJta9DYcP3Vjtee5lwSCy6EpbY/jlZ97mqPw0jY3LlW6LEwfzC5Ac39MOHBCJxKag2xi1zW3gUDHwZQDpI3ap6LNoaiUx0j5lmkPxmuUx4GWPHRi2zKWh9Lco/jBpQkybYE41g3stwQFmHukB6PxLFbXzR24JohatVWeG2EV1+kpU809Jrd6j+Pna6oZFJc+1qVSFtKCIoCY8uVS0EHm3m5ECcY54Oq+3P2Ts8Yh98Y/Qc7VfvtokzWxeiIylxkEIwFtyxcNANvUNIDAQCChGA3FfDogKwgirYFs8HhaJIaex/k2YoNmlN1HfW9MEjWgqQebomVqNEH9yo9DWIoDSOspPkZ/vFA2X86NewE1zCXF5aDs5d8UtF1zYtyuXc+34SCmJdAMj/fxsJQYY7ctqsS0zODuuOmvtf0B+e/E0uXARsB/GC305pWBkYDBGT2JbGdTJCgDbld6sVF/j/0Qyr3yAVRjujIuVnl3QjYlxR0CQYl/INlwgMAEOP8AcULBos=

  # TEST Parameter
  - name: homes-site-params-test
    type: params
    version:
      params:
        NODE_ENV: 'production' # this is to start APP with development version of react
        APP_ENV: 'test' # this is to start APP using automation config
        APP_STUBBED: true # this is to start APP stubbed
        APP_DEBUG: true

  # TEST secure env
  - name: homes-site-test-env
    type: params
    versionTemplate:
      params:
        # EMAIL_HASH_SERVICE_SECRET_KEY AWS_ACCESS_KEY_ID AWS_SECRET_ACCESS_KEY APP_SERVICES_ACCESS_KEY
        secure: fDacU9ZNJj0YHEhcHPfit3AK8NvIneSRDpw4DBvgb/1hkaj/4mCI1BGBv1RjdRxcxVqZ6k7kf7krhUCJzd+bhIaOn3A0QzKzCxNqQRtU/UAgLvjc6R7RoCXOXesmM5KVxRbghW73oVlTSQ0IUyKQ8NMxK32NeY2n0C/gCC2KHlJta9DYcP3Vjtee5lwSCy6EpbY/jlZ97mqPw0jY3LlW6LEwfzC5Ac39MOHBCJxKag2xi1zW3gUDHwZQDpI3ap6LNoaiUx0j5lmkPxmuUx4GWPHRi2zKWh9Lco/jBpQkybYE41g3stwQFmHukB6PxLFbXzR24JohatVWeG2EV1+kpU809Jrd6j+Pna6oZFJc+1qVSFtKCIoCY8uVS0EHm3m5ECcY54Oq+3P2Ts8Yh98Y/Qc7VfvtokzWxeiIylxkEIwFtyxcNANvUNIDAQCChGA3FfDogKwgirYFs8HhaJIaex/k2YoNmlN1HfW9MEjWgqQebomVqNEH9yo9DWIoDSOspPkZ/vFA2X86NewE1zCXF5aDs5d8UtF1zYtyuXc+34SCmJdAMj/fxsJQYY7ctqsS0zODuuOmvtf0B+e/E0uXARsB/GC305pWBkYDBGT2JbGdTJCgDbld6sVF/j/0Qyr3yAVRjujIuVnl3QjYlxR0CQYl/INlwgMAEOP8AcULBos=

  # SIT/TEST - Number of task to run in AWS cluster
  - name: homes-site-replicas-non-prod
    type: replicas
    version:
      count: 2

  ####################################
  # PROD environment configuration
  # DO NOT DELETE
  # DO NOT DELETE
  # DO NOT DELETE
  ####################################

  # AWS Prod Cluster
  - name: homes-env-prod-ecs
    type: cluster
    integration: digital-prod-AWS
    pointer:
      sourceName: 'app_ecs'
      region: 'ap-southeast-2'

  # AWS PROD load Balancer - Homes PROD - MASTER branch
  - name: homes-site-alb-prod
    type: loadBalancer
    pointer:
      sourceName: 'arn:aws:elasticloadbalancing:ap-southeast-2:622156575630:targetgroup/homes-site-au-prod/1f2d108e074bc534'
      method: application

  # PROD parameters
  - name: homes-site-params-prod
    type: params
    version:
      params:
        NODE_ENV: 'production' # this is to start APP with development version of react
        APP_ENV: 'prod' # this is to start APP using production config
        APM_KEY: 'c777240932e6282ffacc6a42ae6a0709426522bb' # New relic key
        # EMAIL_HASH_SERVICE_SECRET_KEY AWS_ACCESS_KEY_ID AWS_SECRET_ACCESS_KEY APP_SERVICES_ACCESS_KEY
        secure: lBMK3NzsjTeLoEFL+P/XbsZMvz71xl9TZrKTNhGp4LRzmfPmg239d3kVyO+Un8e9sQD2sRirIMfbN71X/XND5NFJrU+RcLvNtYyGur5k5gmdl8gJPzCDy3xKUADr6RmwdxPd7Q9jMFI4noIXOfA3kx6RWK6X7lxSPZGyTGBkPi6QQ8XwYMt7Bhdx0ZVM6q9UyqBqJnMhMs4biPitz8ZgmNzE+BFccnmXDjJDuTK+JzAnD3MGWZygV3c08Zl75Wi+BTUBsFddyyoKoAN85sEfnfZjUDXgWFJS5jORecZasTudZdw/6mq6G1/uXheQ5tOWN42lwZ9GxbwEjAZLHjyET6gyxS73XeZ/0pssq/l+cUM5dLQ7CGvDH+pJgSN2bv8OZKJ1KkUrJk0TWyCZxC5jSNXA6MEBiLCJzU5K85bnApfZ9rT5F2wocN/zGgmywMgNl5xFoNouJwTTMJka2ZOVqvXSmlW8+3PH6B21eVPVO154tQ7JW/EzfiGnsudFYCXW3UQVCP2/twVAYZOqlNf/a95HPGNKHy+DTUhr5nQdXVaD9+kxTVolby1B8HHdHOpQyEf/6DGGWlW3R4vE0hxo+ohyqP4VJiXZKKPWjft7gdb7hytIwKI28YFvhhZYizbg0kHWW2s6taeiLDc1MFJQBJ8/7TxfkpVsfrwWA3OQKr0=

  # PROD - Number of task to run in AWS cluster
  - name: homes-site-replicas-production
    type: replicas
    version:
      count: 3
